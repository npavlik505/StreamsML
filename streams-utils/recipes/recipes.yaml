recipes:
  nv:
    summary: Build NVIDIA HPC base image.
    types:
      default:
        subtypes:
          default:
            flags: []

  base:
    summary: Build base container using apptainer.
    types:
      default:
        subtypes:
          default:
            flags: []

  build:
    summary: Build streams container image.
    types:
      default:
        subtypes:
          default:
            flags: []

  config:
    summary: Generate a solver configuration file.
    types:
      openloop:
        subtypes:
          constant:
            flags:
              - "--steps 50000"
              - "--reynolds-number 250"
              - "--mach-number 2.28"
              - "--shock-angle 8.0"
              - "--x-length 27.0"
              - "--x-divisions 800"
              - "--y-length 6.0"
              - "--y-divisions 208"
              - "--z-length 3.8"
              - "--z-divisions 150"
              - "--mpi-x-split 4"
              - "# --dry"
              - "--span-average-io-steps 100"
              - "--probe-io-steps 0"
              - "--python-flowfield-steps 100"
              - "--use-python"
              - "--json"
              - "--nymax-wr 201"
              - "--rly-wr 2.5"
              - "--sensor-threshold 0.1"
              - "--restart-flag 0"
              - "--dtsave-restart 2.5"
              - "# --fixed-dt 0.0008439"
              - "--shock-impingement 15.0"
              - "# --probe-locations-x 10,20"
              - "# --probe-locations-z 5,15"
              - "# --snapshots-3d"
              - "# --disable-restart-io"
              - "open-loop constant"
              - "--slot-start 0"
              - "--slot-end 0"
              - "--amplitude 1.0"
              - "--actuation-interval 1"
          sinusoidal:
            flags:
              - "--steps 50000"
              - "--reynolds-number 250"
              - "--mach-number 2.28"
              - "--shock-angle 8.0"
              - "--x-length 27.0"
              - "--x-divisions 800"
              - "--y-length 6.0"
              - "--y-divisions 208"
              - "--z-length 3.8"
              - "--z-divisions 150"
              - "--mpi-x-split 4"
              - "# --dry"
              - "--span-average-io-steps 100"
              - "--probe-io-steps 0"
              - "--python-flowfield-steps 100"
              - "--use-python"
              - "--json"
              - "--nymax-wr 201"
              - "--rly-wr 2.5"
              - "--sensor-threshold 0.1"
              - "--restart-flag 0"
              - "--dtsave-restart 2.5"
              - "# --fixed-dt 0.0008439"
              - "--shock-impingement 15.0"
              - "# --probe-locations-x 10,20"
              - "# --probe-locations-z 5,15"
              - "# --snapshots-3d"
              - "# --disable-restart-io"
              - "open-loop sinusoidal"
              - "--slot-start 0"
              - "--slot-end 0"
              - "--amplitude 1.0"
              - "--angular-frequency 1.0"
              - "--actuation-interval 1"
          dmdc:
            flags:
              - "--steps 50000"
              - "--reynolds-number 250"
              - "--mach-number 2.28"
              - "--shock-angle 8.0"
              - "--x-length 27.0"
              - "--x-divisions 800"
              - "--y-length 6.0"
              - "--y-divisions 208"
              - "--z-length 3.8"
              - "--z-divisions 150"
              - "--mpi-x-split 4"
              - "# --dry"
              - "--span-average-io-steps 100"
              - "--probe-io-steps 0"
              - "--python-flowfield-steps 100"
              - "--use-python"
              - "--json"
              - "--nymax-wr 201"
              - "--rly-wr 2.5"
              - "--sensor-threshold 0.1"
              - "--restart-flag 0"
              - "--dtsave-restart 2.5"
              - "# --fixed-dt 0.0008439"
              - "--shock-impingement 15.0"
              - "# --probe-locations-x 10,20"
              - "# --probe-locations-z 5,15"
              - "# --snapshots-3d"
              - "# --disable-restart-io"
              - "open-loop dmdc"
              - "--slot-start 0"
              - "--slot-end 0"
              - "--amplitude 1.0"
              - "--actuation-interval 1"
      classical:
        subtypes:
          opp:
            flags:
              - "--steps 50000"
              - "--reynolds-number 250"
              - "--mach-number 2.28"
              - "--shock-angle 8.0"
              - "--x-length 27.0"
              - "--x-divisions 800"
              - "--y-length 6.0"
              - "--y-divisions 208"
              - "--z-length 3.8"
              - "--z-divisions 150"
              - "--mpi-x-split 4"
              - "# --dry"
              - "--span-average-io-steps 100"
              - "--probe-io-steps 0"
              - "--python-flowfield-steps 100"
              - "--use-python"
              - "--json"
              - "--nymax-wr 201"
              - "--rly-wr 2.5"
              - "--sensor-threshold 0.1"
              - "--restart-flag 0"
              - "--dtsave-restart 2.5"
              - "# --fixed-dt 0.0008439"
              - "--shock-impingement 15.0"
              - "# --probe-locations-x 10,20"
              - "# --probe-locations-z 5,15"
              - "# --snapshots-3d"
              - "# --disable-restart-io"
              - "classical opp"
              - "--slot-start 0"
              - "--slot-end 0"
              - "--obs-type u"
              - "--obs-xstart 0"
              - "--obs-xend 0"
              - "--obs-ystart 0"
              - "--obs-yend 0"
              - "# --obs-points (10,5)(12,6)"
              - "--organized-motion undefined"
              - "--gain 1.0"
              - "--amplitude 1.0"
              - "--lag-steps 1"
              - "--actuation-interval 1"
      learningbased:
        subtypes:
          ddpg:
            flags:
              - "--steps 50000"
              - "--reynolds-number 250"
              - "--mach-number 2.28"
              - "--shock-angle 8.0"
              - "--x-length 27.0"
              - "--x-divisions 800"
              - "--y-length 6.0"
              - "--y-divisions 208"
              - "--z-length 3.8"
              - "--z-divisions 150"
              - "--mpi-x-split 4"
              - "# --dry"
              - "--span-average-io-steps 100"
              - "--probe-io-steps 0"
              - "--python-flowfield-steps 100"
              - "--use-python"
              - "--json"
              - "--nymax-wr 201"
              - "--rly-wr 2.5"
              - "--sensor-threshold 0.1"
              - "--restart-flag 0"
              - "--dtsave-restart 2.5"
              - "# --fixed-dt 0.0008439"
              - "--shock-impingement 15.0"
              - "# --probe-locations-x 10,20"
              - "# --probe-locations-z 5,15"
              - "# --snapshots-3d"
              - "# --disable-restart-io"
              - "learning-based ddpg"
              - "--slot-start 0"
              - "--slot-end 0"
              - "--obs-type u"
              - "--sensor-actuator-delay"
              - "--obs-xstart 0"
              - "--obs-xend 0"
              - "--obs-ystart 0"
              - "--obs-yend 0"
              - "# --obs-points (10,5)(12,6)"
              - "--amplitude 1.0"
              - "--lag-steps 1"
              - "--actuation-interval 1"
              - "--train-episodes 10"
              - "--training-output /RL_metrics/training.h5"
              - "--eval-episodes 10"
              - "--eval-max-steps 1000"
              - "--eval-output /RL_metrics/evaluation.h5"
              - "--checkpoint-interval 1"
              - "--checkpoint-dir /RL_metrics/checkpoint"
              - "--seed 42"
              - "--hidden-width 8"
              - "--batch-size 50"
              - "--learning-rate 0.0003"
              - "--gamma 0.99"
              - "--tau 0.005"
              - "--buffer-size 1000000"
          dqn:
            flags:
              - "--steps 50000"
              - "--reynolds-number 250"
              - "--mach-number 2.28"
              - "--shock-angle 8.0"
              - "--x-length 27.0"
              - "--x-divisions 800"
              - "--y-length 6.0"
              - "--y-divisions 208"
              - "--z-length 3.8"
              - "--z-divisions 150"
              - "--mpi-x-split 4"
              - "# --dry"
              - "--span-average-io-steps 100"
              - "--probe-io-steps 0"
              - "--python-flowfield-steps 100"
              - "--use-python"
              - "--json"
              - "--nymax-wr 201"
              - "--rly-wr 2.5"
              - "--sensor-threshold 0.1"
              - "--restart-flag 0"
              - "--dtsave-restart 2.5"
              - "# --fixed-dt 0.0008439"
              - "--shock-impingement 15.0"
              - "# --probe-locations-x 10,20"
              - "# --probe-locations-z 5,15"
              - "# --snapshots-3d"
              - "# --disable-restart-io"
              - "learning-based dqn"
              - "--slot-start 0"
              - "--slot-end 0"
              - "--obs-type u"
              - "--sensor-actuator-delay"
              - "--obs-xstart 0"
              - "--obs-xend 0"
              - "--obs-ystart 0"
              - "--obs-yend 0"
              - "# --obs-points (10,5)(12,6)"
              - "--amplitude 1.0"
              - "--lag-steps 1"
              - "--actuation-interval 1"
              - "--train-episodes 10"
              - "--training-output /RL_metrics/training"
              - "--eval-episodes 10"
              - "--eval-max-steps 1000"
              - "--eval-output /RL_metrics/eval"
              - "--checkpoint-interval 5"
              - "--checkpoint-dir /RL_metrics/checkpoint"
              - "--seed 42"
              - "--hidden-width 8"
              - "--batch-size 50"
              - "--learning-rate 0.0003"
              - "--target-update 1000"
              - "--gamma 0.99"
              - "--tau 0.005"
              - "--epsilon 0.05"
              - "--buffer-size 1000000"
          ppo:
            flags:
              - "--steps 50000"
              - "--reynolds-number 250"
              - "--mach-number 2.28"
              - "--shock-angle 8.0"
              - "--x-length 27.0"
              - "--x-divisions 800"
              - "--y-length 6.0"
              - "--y-divisions 208"
              - "--z-length 3.8"
              - "--z-divisions 150"
              - "--mpi-x-split 4"
              - "# --dry"
              - "--span-average-io-steps 100"
              - "--probe-io-steps 0"
              - "--python-flowfield-steps 100"
              - "--use-python"
              - "--json"
              - "--nymax-wr 201"
              - "--rly-wr 2.5"
              - "--sensor-threshold 0.1"
              - "--restart-flag 0"
              - "--dtsave-restart 2.5"
              - "# --fixed-dt 0.0008439"
              - "--shock-impingement 15.0"
              - "# --probe-locations-x 10,20"
              - "# --probe-locations-z 5,15"
              - "# --snapshots-3d"
              - "# --disable-restart-io"
              - "learning-based ppo"
              - "--slot-start 0"
              - "--slot-end 0"
              - "--obs-type u"
              - "--sensor-actuator-delay"
              - "--obs-xstart 0"
              - "--obs-xend 0"
              - "--obs-ystart 0"
              - "--obs-yend 0"
              - "--amplitude 1.0"
              - "--lag-steps 1"
              - "--actuation-interval 1"
              - "--train-episodes 10"
              - "--training-output /RL_metrics/training"
              - "--eval-episodes 10"
              - "--eval-max-steps 1000"
              - "--eval-output /RL_metrics/eval"
              - "--checkpoint-interval 5"
              - "--checkpoint-dir /RL_metrics/checkpoint"
              - "--seed 42"
              - "--hidden-width 8"
              - "--batch-size 50"
              - "--learning-rate 0.0003"
              - "--gamma 0.99"
              - "--eps-clip 0.02"
              - "--k-epochs 10"

  run:
    summary: Run the solver / environment.
    types:
      default:
        subtypes:
          default:
            flags:
              - "--train-only"
              - "# --eval-only"
              - "# --checkpoint \"/checkpoints/{{checkpoint_tag}}\""

  visualize:
    summary: Visualization helpers.
    types:
      snapshot:
        subtypes:
          default:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--vis-type snapshot"
              - "--snapshot-number 1"
              - "--variable rho"
      animation:
        subtypes:
          default:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--vis-type animation"
              - "--variable w"
      rl_metrics:
        subtypes:
          default:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--vis-type rl_metrics"
      sa_data:
        subtypes:
          default:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--vis-type sa_data"

  analysis:
    summary: Offline analysis helpers.
    types:
      default:
        subtypes:
          POD:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--analysis-method POD"
          DMD:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--analysis-method DMD"
          PySensors:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--analysis-method PySensors"
              - "--num-sensors 6"

  model:
    summary: Modeling helpers.
    types:
      dmdc:
        subtypes:
          run_dmdc:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--model-type dmdc"
              - "--workflow run_dmdc"
              - "--energy 90"
              - "--velocity-components 1,2,3"
              - "--block-rows 16"
              - "--time-batch 16"
          validate_rom:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--model-type dmdc"
              - "--workflow validate_rom"
              - "--energy 90"
              - "--velocity-components 1,2,3"
              - "--validation-sa {{validation_sa}}"
              - "--validation-traj {{validation_traj}}"
              - "# --compute-pointwise-error"
          plot_modes:
            flags:
              - "--results_dir {{results_dir}}"
              - "--episode-tag ep_0000"
              - "--model-type dmdc"
              - "--workflow plot_modes"
              - "--energy 90"
              - "--n-modes 5"
              - "--velocity-components 1,2,3"
